<view class="container">
  <!-- 1. å¯¼èˆªæ è®¾è®¡ -->
  <view class="header">
    <view class="title">å±•è§ˆé¢„çº¦</view>
    <view class="search-icon" bindtap="onSearchTap">
      <image src="/images/icons/search.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢æ  -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'exhibition' ? 'active' : ''}}" 
          bindtap="onTabChange" 
          data-tab="exhibition">å±•è§ˆ</view>
    <view class="tab-item {{activeTab === 'collection' ? 'active' : ''}}" 
          bindtap="onTabChange" 
          data-tab="collection">è—å“</view>
  </view>

  <!-- å±•è§ˆæ ‡ç­¾å†…å®¹ -->
  <view wx:if="{{activeTab === 'exhibition'}}">
    <!-- 4. ç­›é€‰åŠŸèƒ½ -->
    <scroll-view class="filter-bar" scroll-x="true">
      <view class="filter-group">
        <view class="filter-item {{filter.status === 'all' ? 'active' : ''}}" 
              bindtap="onFilterTap" 
              data-type="status" 
              data-value="all">å…¨éƒ¨å±•è§ˆ</view>
        <view class="filter-item {{filter.status === 'ongoing' ? 'active' : ''}}" 
              bindtap="onFilterTap" 
              data-type="status" 
              data-value="ongoing">è¿›è¡Œä¸­</view>
        <view class="filter-item {{filter.status === 'upcoming' ? 'active' : ''}}" 
              bindtap="onFilterTap" 
              data-type="status" 
              data-value="upcoming">å³å°†å¼€å§‹</view>
        <view class="filter-item {{filter.status === 'ended' ? 'active' : ''}}" 
              bindtap="onFilterTap" 
              data-type="status" 
              data-value="ended">å·²ç»“æŸ</view>
      </view>
    </scroll-view>

    <!-- 2. å±•è§ˆåˆ—è¡¨å¡ç‰‡ -->
    <scroll-view class="exhibition-list" 
                scroll-y="true" 
                bindscrolltolower="onReachBottom"
                refresher-enabled="{{true}}"
                refresher-triggered="{{refreshing}}"
                bindrefresherrefresh="onPullDownRefresh">
      <block wx:if="{{exhibitions.length > 0}}">
        <view class="exhibition-card" 
              wx:for="{{exhibitions}}" 
              wx:key="id" 
              bindtap="onExhibitionTap" 
              data-id="{{item.id}}">
          <!-- å±•è§ˆä¸»å›¾ -->
          <image class="exhibition-image" 
                src="{{baseUrl}}/file/getPic?name={{item.colPic}}" 
                mode="aspectFill" 
                binderror="onImageError" 
                data-index="{{index}}"></image>
          
          <!-- æ”¶è—æŒ‰é’® -->
          <view class="like-btn exhibition-like-btn" catchtap="onExhibitionLikeTap" data-id="{{item.id}}">
            <image src="/images/love/{{likedExhibitions[item.id] ? 'love-active.png' : 'love.png'}}" class="like-icon"/>
          </view>
          
          <!-- å±•è§ˆä¿¡æ¯ -->
          <view class="exhibition-info">
            <view class="exhibition-title">{{item.title}}</view>
            
            <!-- å±•è§ˆæ—¶é—´ -->
            <view class="exhibition-meta">
              <image class="meta-icon" src="/images/icons/date.png"></image>
              <text class="meta-text">{{item.startDate}} - {{item.endDate}}</text>
            </view>
            
            <!-- å±•è§ˆåœ°ç‚¹ -->
            <view class="exhibition-meta">
              <image class="meta-icon" src="/images/icons/location.png"></image>
              <text class="meta-text">{{item.location || 'ä¸´å±•é¦†1å·å…'}}</text>
            </view>
            
            <!-- å±•è§ˆçŠ¶æ€æ ‡ç­¾ -->
            <view class="status-tag {{item.status}}">
              {{item.status === 'upcoming' ? 'å³å°†å¼€å§‹' : item.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}
            </view>
            
            <!-- å¿«é€Ÿé¢„çº¦æŒ‰é’® -->
            <view class="reserve-btn {{item.status === 'ended' ? 'disabled' : ''}}" 
                  catchtap="onReserveTap" 
                  data-id="{{item.id}}">
              {{item.status === 'ended' ? 'å·²ç»“æŸ' : 'é¢„çº¦'}}
            </view>
          </view>
        </view>
      </block>
      
      <!-- 6. åº•éƒ¨æç¤º -->
      <view class="loading" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
      <view class="no-more" wx:if="{{exhibitions.length >= total && total > 0}}">æ²¡æœ‰æ›´å¤šå±•è§ˆäº†</view>
      <view class="empty" wx:if="{{exhibitions.length === 0 && !loading}}">
        <text class="empty-icon-text">ğŸ”</text>
        <text class="empty-text">æš‚æ— å±•è§ˆä¿¡æ¯</text>
      </view>
    </scroll-view>
  </view>

  <!-- è—å“æ ‡ç­¾å†…å®¹ -->
  <view wx:if="{{activeTab === 'collection'}}">
    <!-- åˆ†ç±»åˆ—è¡¨ -->
    <scroll-view class="category-list" scroll-x="true">
      <view class="category-item {{item.name === currentCategory ? 'active' : ''}}"
            wx:for="{{categories}}"
            wx:key="id"
            bindtap="onCategoryTap"
            data-category="{{item.name}}">
        {{item.name}}
      </view>
    </scroll-view>

    <!-- è—å“åˆ—è¡¨ - æ”¹ç”¨scroll-view -->
    <scroll-view class="collection-list" 
                scroll-y="true" 
                bindscrolltolower="onReachBottom"
                refresher-enabled="{{true}}"
                refresher-triggered="{{refreshing}}"
                bindrefresherrefresh="onPullDownRefresh">
      <block wx:if="{{collectionList.length > 0}}">
        <view class="collection-item"
              wx:for="{{collectionList}}"
              wx:key="id"
              bindtap="onCollectionTap"
              data-id="{{item.id}}">
          <image src="{{baseUrl}}/file/getPic?name={{item.colPic}}" 
                mode="aspectFill" 
                class="collection-image"
                binderror="onCollectionImageError" 
                data-index="{{index}}"/>
          <view class="collection-info">
            <text class="collection-name">{{item.title}}</text>
            <text class="collection-dynasty">{{item.dynasty}}</text>
            <text class="collection-desc">{{formatDesc(item.desColl)}}</text>
          </view>
          <view class="like-btn" catchtap="onCollectionLikeTap" data-id="{{item.id}}">
            <image src="/images/love/{{likedItems[item.id] ? 'love-active.png' : 'love.png'}}" class="like-icon"/>
          </view>
        </view>
      </block>
      
      <!-- åº•éƒ¨æç¤º -->
      <view class="loading" wx:if="{{collectionLoading}}">åŠ è½½ä¸­...</view>
      <view class="no-more" wx:if="{{collectionList.length >= collectionTotal && collectionTotal > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
      <view class="empty" wx:if="{{collectionList.length === 0 && !collectionLoading}}">
        <text class="empty-icon-text">ğŸ”</text>
        <text class="empty-text">æš‚æ— è—å“</text>
      </view>
    </scroll-view>
  </view>
  
  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <view class="back-to-top" bindtap="backToTop" wx:if="{{showBackToTop}}">
    <image src="/images/icons/top.png"></image>
  </view>
  
  <!-- éšç§åè®®å¼¹çª— -->
  <privacy-modal show="{{showPrivacyModal}}" 
                bind:agree="onPrivacyAgree"
                bind:reject="onPrivacyReject" />
                
  <!-- æ‰‹æœºå·æˆæƒå¼¹çª— -->
  <phone-auth-modal show="{{showPhoneModal}}"
                  phone-number="{{phoneNumber}}"
                  bind:confirm="onPhoneConfirm"
                  bind:reject="onPhoneReject"
                  bind:useOtherPhone="onUseOtherPhone" />
</view>